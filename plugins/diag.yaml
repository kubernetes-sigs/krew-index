apiVersion: krew.googlecontainertools.github.com/v1alpha2
kind: Plugin
metadata:
  name: diag
spec:
  version: v0.0.9
  homepage: https://github.com/solo-io/kdiag
  platforms:
  - uri: https://github.com/solo-io/kdiag/releases/download/v0.0.9/kubectl-diag_v0.0.9_darwin_amd64.tar.gz
    sha256: fd38a1a2ace63bcf688879e32d94d0b6a556094b9733477b71c9ac1d7ce377b4
    bin: kubectl-diag
    files:
    - from: kubectl-diag
      to: kubectl-diag
    - from: LICENSE
      to: .
    selector:
      matchLabels:
        os: darwin
        arch: amd64
  - uri: https://github.com/solo-io/kdiag/releases/download/v0.0.9/kubectl-diag_v0.0.9_darwin_arm64.tar.gz
    sha256: 313930e71e5b5d6969ab888e8bd267be3a19d0f868b6036e10768f9f16e22a0a
    bin: kubectl-diag
    files:
    - from: kubectl-diag
      to: kubectl-diag
    - from: LICENSE
      to: .
    selector:
      matchLabels:
        os: darwin
        arch: arm64
  - uri: https://github.com/solo-io/kdiag/releases/download/v0.0.9/kubectl-diag_v0.0.9_linux_amd64.tar.gz
    sha256: b730497346284b919e7d18786f924589b801dac0a7904bdd58898214679f3221
    bin: kubectl-diag
    files:
    - from: kubectl-diag
      to: .
    - from: LICENSE
      to: .
    selector:
      matchLabels:
        os: linux
        arch: amd64
  - uri: https://github.com/solo-io/kdiag/releases/download/v0.0.9/kubectl-diag_v0.0.9_windows_amd64.tar.gz
    sha256: 1339b8d745fd2d61aa5e8cd063dc6f724a4c6598d307ba599db935fdd6cd91f6
    bin: kubectl-diag.exe
    files:
    - from: kubectl-diag.exe
      to: kubectl-diag.exe
    - from: LICENSE
      to: .
    selector:
      matchLabels:
        os: windows
        arch: amd64
  shortDescription: Debug/Diagnostics tools for kubernetes backend systems developers.
  caveats: |
    This uses high privilege ephemeral containers, and not suited for production.
  description: |
        Systems that span multiple micro-services (istio for example), can be hard to debug.
        This plugin has a set of tools to assist you with such debugging:
        - Redirecting traffic from a pod to a laptop, so you can run a server on your laptop and redirect client
          traffic from the cluster to it (i.e. run istiod with your changes locally, and have envoy from the cluster connect to it)
        - Viewing logs from multiple pods at the same time (i.e. run a curl command and see logs form all the bookinfo pods as the request travels through them)
        - Ability to exec into distroless/scratch containers. To let you can exec to your pods even if they don't have a shell binary in them (i.e. deployments in staging environments).

