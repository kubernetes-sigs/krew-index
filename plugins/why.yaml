apiVersion: krew.googlecontainertools.github.com/v1alpha2
kind: Plugin
metadata:
  name: why
spec:
  version: "v0.1.1"
  homepage: https://github.com/opensource-alison/why-blocked
  shortDescription: "Explain why a Kubernetes resource was blocked"
  description: |
    kubectl-why explains why a Kubernetes resource was blocked by security rules.
    It is a reasoning CLI (not a scanner): fast, offline-first, and human-readable.
    Optional enhancements can attach CVE/SBOM scan results from external tools and
    enrich explanations via an optional AI worker.
  caveats: |
    Optional features require external dependencies:
      - CVE scan attachment: install 'trivy' and use --scan cve
      - SBOM attachment: install 'syft' and use --scan sbom
      - AI enrichment: set WHY_AI_API_KEY and use --ai (requires Python)
    Without these, kubectl-why works fully offline with static checks only.

  platforms:
    - selector:
        matchLabels:
          os: darwin
          arch: amd64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_darwin_amd64.tar.gz
      sha256: "39f2029e93e3824f37808b191012c5cfbf8104d65470fb35262e7743b243a20d"
      bin: kubectl-why
      files:
        - from: LICENSE
          to: .

    - selector:
        matchLabels:
          os: darwin
          arch: arm64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_darwin_arm64.tar.gz
      sha256: "36210761128953ef40de7a9435bffaceab23f073e6c366142fb87d2c438bd4fa"
      bin: kubectl-why
      files:
        - from: LICENSE
          to: .

    - selector:
        matchLabels:
          os: linux
          arch: amd64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_linux_amd64.tar.gz
      sha256: "11446d572dfeb14de4f5e0d6ef0a292e81ee75fce23cedb3130462de21cdbc39"
      bin: kubectl-why
      files:
        - from: LICENSE
          to: .

    - selector:
        matchLabels:
          os: linux
          arch: arm64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_linux_arm64.tar.gz
      sha256: "c5d59b659d3312bde8bf632d27837c80458da7c6c16e892bafc3399c8eb70dbc"
      bin: kubectl-why
      files:
        - from: LICENSE
          to: .

    - selector:
        matchLabels:
          os: windows
          arch: amd64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_windows_amd64.zip
      sha256: "b3db7fdd990222480deaef28f69ffe5ce749e7a08e0043a95e9d6c687ecb5b54"
      bin: kubectl-why.exe
      files:
        - from: LICENSE
          to: .

    - selector:
        matchLabels:
          os: windows
          arch: arm64
      uri: https://github.com/opensource-alison/why-blocked/releases/download/v0.1.1/kubectl-why_0.1.1_windows_arm64.zip
      sha256: "29cae0c5769db20ffd60d1ff656fe396a6222facffd9328a0db388138f3155a7"
      bin: kubectl-why.exe
      files:
        - from: LICENSE
          to: .